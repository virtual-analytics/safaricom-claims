{% extends "base1.html" %}
{% load humanize %}

{% block title %}Advanced Claims Forecasting - Safaricom Portal{% endblock %}

{% block head %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}

{% block content %}
<div class="forecast-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="header-text">
                <h1>Advanced Claims Forecasting</h1>
                <p>AI-powered predictive analytics for future claims volume and financial planning</p>
            </div>
        </div>
    </div>

    <!-- Alert Section -->
    {% if error %}
    <div class="alert alert-danger">
        <div class="alert-icon">
            <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="alert-content">
            <h4>Analysis Error</h4>
            <p>{{ error }}</p>
        </div>
        <button class="alert-close" onclick="this.parentElement.style.display='none'">
            <i class="fas fa-times"></i>
        </button>
    </div>
    {% endif %}
    
    <!-- Filter Controls -->
    <div class="card filter-section">
        <div class="card-header">
            <h3><i class="fas fa-sliders-h"></i> Analysis Parameters</h3>
            <div class="header-badge">
                <span class="badge badge-primary">Advanced Models</span>
            </div>
        </div>
        <div class="card-body">
            <form method="GET" id="forecast-filter-form">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="time-period">
                            <i class="fas fa-calendar-alt"></i> Historical Period
                        </label>
                        <select id="time-period" name="time_period" class="searchable-select">
                            <option value="3m" {% if selected_time_period == '3m' %}selected{% endif %}>Last 3 Months</option>
                            <option value="6m" {% if selected_time_period == '6m' %}selected{% endif %}>Last 6 Months</option>
                            <option value="12m" {% if selected_time_period == '12m' %}selected{% endif %}>Last 12 Months</option>
                            <option value="24m" {% if selected_time_period == '24m' %}selected{% endif %}>Last 24 Months</option>
                            <option value="36m" {% if selected_time_period == '36m' %}selected{% endif %}>Last 36 Months</option>
                            <option value="all" {% if selected_time_period == 'all' %}selected{% endif %}>All Time</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="benefit-type">
                            <i class="fas fa-stethoscope"></i> Benefit Type
                        </label>
                        <select id="benefit-type" name="benefit_type" class="searchable-select">
                            <option value="all" {% if selected_benefit_type == 'all' %}selected{% endif %}>All Benefit Types</option>
                            {% for benefit in benefit_types %}
                                <option value="{{ benefit }}" {% if selected_benefit_type == benefit %}selected{% endif %}>{{ benefit }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="provider">
                            <i class="fas fa-hospital"></i> Provider
                        </label>
                        <select id="provider" name="provider" class="searchable-select">
                            <option value="all" {% if selected_provider == 'all' %}selected{% endif %}>All Providers</option>
                            {% for prov in providers %}
                                <option value="{{ prov }}" {% if selected_provider == prov %}selected{% endif %}>{{ prov }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="forecast-months">
                            <i class="fas fa-hourglass-half"></i> Forecast Horizon
                        </label>
                        <select id="forecast-months" name="forecast_months">
                            {% for months in forecast_horizon_options %}
                                <option value="{{ months }}" {% if selected_forecast_months == months %}selected{% endif %}>{{ months }} Months</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="model">
                            <i class="fas fa-brain"></i> Prediction Model
                        </label>
                        <select id="model" name="model">
                            {% for value, label in model_options %}
                                <option value="{{ value }}" {% if selected_model == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="seasonal">
                            <i class="fas fa-snowflake"></i> Seasonal Analysis
                        </label>
                        <select id="seasonal" name="seasonal">
                            <option value="true" {% if seasonal_analysis %}selected{% endif %}>Enabled</option>
                            <option value="false" {% if not seasonal_analysis %}selected{% endif %}>Disabled</option>
                        </select>
                    </div>
                    
                    <div class="filter-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-rocket"></i> Generate Forecast
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-filters">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Generating Advanced Forecast</h3>
            <p>Analyzing historical patterns with multiple AI models...</p>
        </div>
    </div>

    <!-- Dashboard Content -->
    {% if forecast_insights or model_performance %}
    <div class="dashboard-content">
        <!-- Key Metrics -->
        <div class="metrics-section">
            <div class="metric-card primary">
                <div class="metric-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">KES {{ forecast_insights.total_forecast|floatformat:0|intcomma }}</div>
                    <div class="metric-label">Total Forecasted Amount</div>
                    <div class="metric-trend {% if forecast_insights.growth_vs_current > 0 %}positive{% else %}negative{% endif %}">
                        <i class="fas fa-arrow-{% if forecast_insights.growth_vs_current > 0 %}up{% else %}down{% endif %}"></i>
                        {{ forecast_insights.growth_vs_current|floatformat:1 }}% vs Current
                    </div>
                </div>
            </div>
            
            <div class="metric-card success">
                <div class="metric-icon">
                    <i class="fas fa-bullseye"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">{{ model_performance.accuracy|default:"75" }}%</div>
                    <div class="metric-label">Model Accuracy</div>
                    <div class="metric-detail">Based on backtesting</div>
                </div>
            </div>
            
            <div class="metric-card info">
                <div class="metric-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">{{ forecast_insights.next_month|floatformat:0|intcomma }}</div>
                    <div class="metric-label">Next Month Forecast</div>
                    <div class="metric-detail">KES {{ forecast_insights.next_month|floatformat:0|intcomma }}</div>
                </div>
            </div>
            
            <div class="metric-card warning">
                <div class="metric-icon">
                    <i class="fas fa-mountain"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value">{{ forecast_insights.peak_month }}</div>
                    <div class="metric-label">Peak Month</div>
                    <div class="metric-detail">KES {{ forecast_insights.peak_value|floatformat:0|intcomma }}</div>
                </div>
            </div>
        </div>

        <!-- Main Visualization Tabs -->
        <div class="card visualization-section">
            <div class="card-header">
                <h3><i class="fas fa-chart-area"></i> Forecast Visualizations</h3>
                <div class="tab-nav" id="visualization-tabs">
                    <button class="tab-link active" data-tab="forecast">Forecast</button>
                    <button class="tab-link" data-tab="seasonal">Seasonal Analysis</button>
                    <button class="tab-link" data-tab="comparison">Model Comparison</button>
                </div>
            </div>
            <div class="card-body">
                <div id="forecast-tab" class="tab-content active">
                    {% if visualizations.main_forecast %}
                        {{ visualizations.main_forecast|safe }}
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-chart-line"></i>
                            <h3>No Forecast Data Available</h3>
                            <p>Adjust your filters and generate a new forecast</p>
                        </div>
                    {% endif %}
                </div>
                
                <div id="seasonal-tab" class="tab-content">
                    {% if visualizations.seasonal_decomp %}
                        {{ visualizations.seasonal_decomp|safe }}
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-snowflake"></i>
                            <h3>Seasonal Analysis Not Available</h3>
                            <p>Enable seasonal analysis or ensure sufficient historical data</p>
                        </div>
                    {% endif %}
                </div>
                
                <div id="comparison-tab" class="tab-content">
                    {% if visualizations.model_comparison %}
                        {{ visualizations.model_comparison|safe }}
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-balance-scale"></i>
                            <h3>Model Comparison Not Available</h3>
                            <p>Multiple models required for comparison</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Insights & Recommendations -->
        <div class="insights-section">
            <!-- Performance Metrics -->
            <div class="card performance-card">
                <div class="card-header">
                    <h3><i class="fas fa-tachometer-alt"></i> Model Performance</h3>
                </div>
                <div class="card-body">
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-value">{{ model_performance.accuracy|default:"75" }}%</div>
                            <div class="performance-label">Accuracy</div>
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: {{ model_performance.accuracy|default:'75' }}%"></div>
                            </div>
                        </div>
                        
                        <div class="performance-item">
                            <div class="performance-value">{{ model_performance.mae|default:"N/A" }}</div>
                            <div class="performance-label">Mean Absolute Error</div>
                            <div class="performance-detail">Lower is better</div>
                        </div>
                        
                        <div class="performance-item">
                            <div class="performance-value">{{ model_performance.mape|default:"N/A" }}%</div>
                            <div class="performance-label">Mean Absolute % Error</div>
                            <div class="performance-detail">Lower is better</div>
                        </div>
                        
                        <div class="performance-item">
                            <div class="performance-value">{{ model_performance.rmse|default:"N/A" }}</div>
                            <div class="performance-label">Root Mean Square Error</div>
                            <div class="performance-detail">Lower is better</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Analysis -->
            <div class="card risk-card">
                <div class="card-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Risk Analysis</h3>
                    <span class="risk-badge {{ risk_analysis.volatility_level|lower }}">{{ risk_analysis.volatility_level }}</span>
                </div>
                <div class="card-body">
                    <div class="risk-metrics">
                        <div class="risk-item">
                            <div class="risk-label">Volatility Level</div>
                            <div class="risk-value {{ risk_analysis.volatility_level|lower }}">{{ risk_analysis.volatility_level }}</div>
                        </div>
                        
                        <div class="risk-item">
                            <div class="risk-label">Max Risk Exposure</div>
                            <div class="risk-value">KES {{ risk_analysis.max_risk_exposure|floatformat:0|intcomma }}</div>
                        </div>
                        
                        <div class="risk-item">
                            <div class="risk-label">Conservative Estimate</div>
                            <div class="risk-value">KES {{ risk_analysis.conservative_estimate|floatformat:0|intcomma }}</div>
                        </div>
                    </div>
                    
                    <div class="risk-description">
                        <p>
                            {% if risk_analysis.volatility_level == 'High' %}
                            High volatility indicates significant month-to-month fluctuations. Consider implementing flexible budgeting and more frequent monitoring.
                            {% elif risk_analysis.volatility_level == 'Medium' %}
                            Moderate volatility suggests predictable patterns with some variation. Standard monitoring procedures should be sufficient.
                            {% else %}
                            Low volatility indicates stable claims patterns. This allows for more accurate long-term planning.
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Business Recommendations -->
            {% if business_recommendations %}
            <div class="card recommendations-card">
                <div class="card-header">
                    <h3><i class="fas fa-lightbulb"></i> Business Recommendations</h3>
                </div>
                <div class="card-body">
                    <div class="recommendations-list">
                        {% for recommendation in business_recommendations %}
                        <div class="recommendation-item {{ recommendation.type }}">
                            <div class="recommendation-icon">
                                <i class="fas fa-{% if recommendation.type == 'warning' %}exclamation-triangle{% elif recommendation.type == 'success' %}check-circle{% else %}info-circle{% endif %}"></i>
                            </div>
                            <div class="recommendation-content">
                                <h4>{{ recommendation.title }}</h4>
                                <p>{{ recommendation.message }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Forecast Details -->
        <div class="card details-card">
            <div class="card-header">
                <h3><i class="fas fa-info-circle"></i> Forecast Details</h3>
            </div>
            <div class="card-body">
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">Forecast Period</div>
                        <div class="detail-value">{{ selected_forecast_months }} Months</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Selected Model</div>
                        <div class="detail-value">
                            {% for value, label in model_options %}
                                {% if value == selected_model %}{{ label }}{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Average Monthly Forecast</div>
                        <div class="detail-value">KES {{ forecast_insights.avg_monthly|floatformat:0|intcomma }}</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Trend Direction</div>
                        <div class="detail-value trend-{{ forecast_insights.trend_direction|lower }}">
                            <i class="fas fa-arrow-{% if forecast_insights.trend_direction == 'Increasing' %}up{% else %}down{% endif %}"></i>
                            {{ forecast_insights.trend_direction }}
                        </div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Monthly Growth Rate</div>
                        <div class="detail-value">{{ forecast_insights.avg_mom_growth|floatformat:1 }}%</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Forecast Volatility</div>
                        <div class="detail-value">KES {{ forecast_insights.volatility|floatformat:0|intcomma }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="empty-dashboard">
        <div class="empty-content">
            <i class="fas fa-chart-line"></i>
            <h2>No Forecast Data Available</h2>
            <p>Configure your analysis parameters and generate your first forecast</p>
            <button class="btn btn-primary" onclick="document.getElementById('forecast-filter-form').submit()">
                <i class="fas fa-rocket"></i> Generate Forecast
            </button>
        </div>
    </div>
    {% endif %}
</div>

<style>
/* Base Styles */
.forecast-dashboard {
    max-width: 1800px;
    margin: 0 auto;
    padding: 0 20px;
    font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
    background-color: #f8fafc;
    color: #2d3748;
    line-height: 1.6;
}

/* Header Styles */
.dashboard-header {
    background: linear-gradient(135deg, #1BB64F 0%, #00A651 100%);
    border-radius: 12px;
    margin: 1.5rem 0;
    color: white; /* default text inside will be white */
    box-shadow: 0 4px 12px rgba(27, 182, 79, 0.2);
}

/* Override only header-text */
.header-text {
    background-color: transparent; /* colourless */
}

.header-text h1,
.header-text p {
    color: green; /* force green text */
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 2rem;
}

.header-icon {
    font-size: 3rem;
    opacity: 0.9;
}

.header-text h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
}

.header-text p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin: 0.5rem 0 0 0;
}

.header-actions .btn {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s;
}

.header-actions .btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

/* Alert Styles */
.alert {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    border-left: 4px solid;
}

.alert-danger {
    background-color: #fef5f5;
    border-color: #f56565;
    color: #c53030;
}

.alert-icon {
    font-size: 1.5rem;
    margin-right: 1rem;
}

.alert-content {
    flex: 1;
}

.alert-content h4 {
    margin: 0 0 0.25rem 0;
    font-size: 1.1rem;
}

.alert-content p {
    margin: 0;
}

.alert-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.3s;
}

.alert-close:hover {
    opacity: 1;
}

/* Card Styles */
.card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    margin-bottom: 1.5rem;
    border: 1px solid #e2e8f0;
    transition: all 0.3s;
    overflow: hidden;
}

.card:hover {
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    background: #f8fafc;
}

.card-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: #2d3748;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-body {
    padding: 1.5rem;
}

/* Filter Styles */
.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.25rem;
    margin-bottom: 1rem;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-group label {
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    color: #4a5568;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group select, .filter-group input {
    padding: 0.75rem 1rem;
    border-radius: 8px;
    border: 1px solid #cbd5e0;
    background-color: white;
    font-family: 'Inter', sans-serif;
    transition: all 0.3s;
}

.filter-group select:focus, .filter-group input:focus {
    border-color: #1BB64F;
    box-shadow: 0 0 0 3px rgba(27, 182, 79, 0.1);
    outline: none;
}

.filter-actions {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Inter', sans-serif;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: none;
}

.btn-primary {
    background: #1BB64F;
    color: white;
}

.btn-primary:hover {
    background: #00A651;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(27, 182, 79, 0.3);
}

.btn-secondary {
    background: #e2e8f0;
    color: #4a5568;
}

.btn-secondary:hover {
    background: #cbd5e0;
    transform: translateY(-2px);
}

.btn-outline {
    background: transparent;
    border: 1px solid #cbd5e0;
    color: #4a5568;
}

.btn-outline:hover {
    background: #f7fafc;
    border-color: #a0aec0;
}

/* Badge Styles */
.badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
}

.badge-primary {
    background: #ebf8ff;
    color: #3182ce;
}

.header-badge {
    display: flex;
    gap: 0.5rem;
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    display: none;
}

.loading-content {
    text-align: center;
    max-width: 400px;
}

.loading-spinner {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #1BB64F;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1.5rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-content h3 {
    margin: 0 0 0.5rem 0;
    color: #2d3748;
}

.loading-content p {
    margin: 0;
    color: #718096;
}

/* Metrics Section */
.metrics-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.metric-card {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    transition: all 0.3s;
    border-left: 4px solid;
}

.metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.metric-card.primary {
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    border-left-color: #3182ce;
}

.metric-card.success {
    background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
    border-left-color: #38a169;
}

.metric-card.info {
    background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
    border-left-color: #3182ce;
}

.metric-card.warning {
    background: linear-gradient(135deg, #fffaf0 0%, #feebc8 100%);
    border-left-color: #dd6b20;
}

.metric-icon {
    font-size: 2.5rem;
    margin-right: 1rem;
    opacity: 0.8;
}

.metric-content {
    flex: 1;
}

.metric-value {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.metric-label {
    font-size: 0.9rem;
    color: #4a5568;
    margin-bottom: 0.5rem;
}

.metric-trend, .metric-detail {
    font-size: 0.85rem;
    font-weight: 600;
}

.metric-trend.positive {
    color: #38a169;
}

.metric-trend.negative {
    color: #e53e3e;
}

/* Tab Navigation */
.tab-nav {
    display: flex;
    gap: 0.5rem;
}

.tab-link {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    background: #e2e8f0;
    border: none;
    font-weight: 600;
    color: #4a5568;
    cursor: pointer;
    transition: all 0.3s;
}

.tab-link.active {
    background: #1BB64F;
    color: white;
}

.tab-link:hover:not(.active) {
    background: #cbd5e0;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Empty States */
.empty-state, .empty-dashboard {
    text-align: center;
    padding: 3rem 2rem;
}

.empty-state i, .empty-dashboard i {
    font-size: 4rem;
    color: #cbd5e0;
    margin-bottom: 1.5rem;
}

.empty-state h3, .empty-dashboard h2 {
    color: #4a5568;
    margin-bottom: 0.5rem;
}

.empty-state p, .empty-dashboard p {
    color: #718096;
    margin-bottom: 1.5rem;
}

/* Performance Grid */
.performance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.performance-item {
    text-align: center;
}

.performance-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1BB64F;
    margin-bottom: 0.5rem;
}

.performance-label {
    font-size: 0.9rem;
    color: #4a5568;
    margin-bottom: 0.5rem;
}

.performance-bar {
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
}

.performance-fill {
    height: 100%;
    background: linear-gradient(to right, #1BB64F, #00A651);
    transition: width 1s ease-in-out;
}

.performance-detail {
    font-size: 0.8rem;
    color: #718096;
    margin-top: 0.25rem;
}

/* Risk Analysis */
.risk-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
}

.risk-badge.high {
    background: #fed7d7;
    color: #c53030;
}

.risk-badge.medium {
    background: #feebcb;
    color: #dd6b20;
}

.risk-badge.low {
    background: #c6f6d5;
    color: #276749;
}

.risk-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.risk-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f7fafc;
    border-radius: 8px;
}

.risk-label {
    font-weight: 600;
    color: #4a5568;
}

.risk-value {
    font-weight: 700;
}

.risk-value.high {
    color: #e53e3e;
}

.risk-value.medium {
    color: #dd6b20;
}

.risk-value.low {
    color: #38a169;
}

.risk-description {
    padding: 1rem;
    background: #edf2f7;
    border-radius: 8px;
    font-style: italic;
}

/* Recommendations */
.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.recommendation-item {
    display: flex;
    align-items: flex-start;
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid;
}

.recommendation-item.warning {
    background: #fffaf0;
    border-left-color: #dd6b20;
}

.recommendation-item.info {
    background: #ebf8ff;
    border-left-color: #3182ce;
}

.recommendation-item.success {
    background: #f0fff4;
    border-left-color: #38a169;
}

.recommendation-icon {
    font-size: 1.25rem;
    margin-right: 1rem;
    margin-top: 0.25rem;
}

.recommendation-item.warning .recommendation-icon {
    color: #dd6b20;
}

.recommendation-item.info .recommendation-icon {
    color: #3182ce;
}

.recommendation-item.success .recommendation-icon {
    color: #38a169;
}

.recommendation-content h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
}

.recommendation-content p {
    margin: 0;
    color: #4a5568;
}

/* Details Grid */
.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f7fafc;
    border-radius: 8px;
}

.detail-label {
    font-weight: 600;
    color: #4a5568;
}

.detail-value {
    font-weight: 700;
    color: #2d3748;
}

.trend-increasing {
    color: #38a169;
}

.trend-decreasing {
    color: #e53e3e;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .header-content {
        flex-direction: column;
        text-align: center;
        gap: 1.5rem;
    }
    
    .filter-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .metrics-section {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .forecast-dashboard {
        padding: 0 15px;
    }
    
    .header-text h1 {
        font-size: 2rem;
    }
    
    .filter-grid {
        grid-template-columns: 1fr;
    }
    
    .metrics-section {
        grid-template-columns: 1fr;
    }
    
    .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .tab-nav {
        width: 100%;
        justify-content: space-between;
    }
    
    .performance-grid, .risk-metrics, .details-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 576px) {
    .header-content {
        padding: 1.5rem;
    }
    
    .header-text h1 {
        font-size: 1.75rem;
    }
    
    .header-text p {
        font-size: 1rem;
    }
    
    .metric-card {
        flex-direction: column;
        text-align: center;
    }
    
    .metric-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .filter-actions {
        flex-direction: column;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Select2
    $('.searchable-select').select2({
        placeholder: "Select an option",
        allowClear: true,
        width: '100%',
        minimumResultsForSearch: 5,
        dropdownAutoWidth: true
    });

    // Handle form submission with loading indicator
    const form = document.getElementById('forecast-filter-form');
    const loadingOverlay = document.getElementById('loadingOverlay');
    
    form.addEventListener('submit', function(e) {
        loadingOverlay.style.display = 'flex';
        
        // Add a small delay to show the loading animation
        setTimeout(function() {
            // The form will submit normally after this
        }, 100);
    });
    
    // Reset filters
    document.getElementById('reset-filters').addEventListener('click', function() {
        form.reset();
        $('.searchable-select').val(null).trigger('change');
    });
    
    // Tab functionality
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabLinks.forEach(link => {
        link.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Update active tab
            tabLinks.forEach(tab => tab.classList.remove('active'));
            this.classList.add('active');
            
            // Show active content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabId}-tab`) {
                    content.classList.add('active');
                }
            });
        });
    });
    
    // Animate progress bars
    document.querySelectorAll('.performance-fill').forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 300);
    });
    
    // Export report functionality
    document.getElementById('export-report').addEventListener('click', function() {
        // In a real implementation, this would generate a PDF or Excel report
        alert('Export functionality would generate a detailed forecast report here.');
    });
    
    // Update forecast months in UI elements
    const forecastMonths = document.getElementById('forecast-months');
    if (forecastMonths) {
        forecastMonths.addEventListener('change', function() {
            const months = this.value;
            // Update any elements that display the forecast period
            document.querySelectorAll('.forecast-period').forEach(el => {
                el.textContent = `${months} Months`;
            });
        });
    }
});
</script>
{% endblock %}